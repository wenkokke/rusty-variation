\documentclass[sigplan,screen,review]{acmart}
\title{Rusty Variation}
\subtitle{Session Types with Failure for Rust}
\author{Wen Kokke}
\orcid{0000-0002-1662-0381}
\affiliation{
  \department{Laboratory for Foundations of Computer Science}
  \institution{University of Edinburgh}
  \streetaddress{10 Crichton Street}
  \city{Edinburgh}
  \state{Scotland}
  \postcode{EH8 9AB}
  \country{United Kingdom}
}
\email{wen.kokke@ed.ac.uk}
\setcopyright{none}
\settopmatter{printccs=false, printacmref=false, printfolios=false}

\input{preamble}
\usepackage[nomarkers,figuresonly]{endfloat}

\begin{document}
\maketitle

\section{Rusty Variation}

\input{fig-rv-static-syntax}
\input{fig-rv-syntactic-sugar}
\input{fig-rv-static-typing}
\input{fig-rv-runtime-syntax}
\input{fig-rv-runtime-typing}
\input{fig-rv-reduction}

\section{Exceptional GV}

\input{fig-egv-static-syntax}
\input{fig-egv-static-typing}
\input{fig-egv-runtime-syntax}
\input{fig-egv-runtime-typing}
\input{fig-egv-reduction}

\subsection{Linear and Affine EGV}
We make three changes to linear EGV to obtain affine EGV:
\begin{enumerate}
\item 
  Remove the $\gvCancel{x}$ construct and the corresponding typing and reduction rules.
\item
  Change the typing rules to allow implicit weakening:
  \begin{prooftree}
    \AXC{$\tmty{\gvVar{x}}{A}\in\ty{\Gamma}$}
    \RightLabel{\textsc{T-Var}}
    \UIC{$\seq{\ty{\Gamma}}{\gvVar{x}}{A}$}
  \end{prooftree}
  \vspace*{0.25\baselineskip}
  \begin{center}
    \begin{prooftree*}
      \AXC{}
      \RightLabel{\textsc{T-Unit}}
      \UIC{$\seq{\ty{\Gamma}}{\gvUnit}{\gvTyUnit}$}
    \end{prooftree*}%
    \begin{prooftree*}
      \AXC{}
      \RightLabel{\textsc{T-Raise}}
      \UIC{$\seq{\ty{\Gamma}}{\gvRaise}{A}$}
    \end{prooftree*}
  \end{center}
\item
  Add a garbage collection reduction, where $\gvArc{\gvVar{a}}{\gvConf{C}}$ counts the number of occurrences of $\gvVar{a}$ in $\gvConf{C}$:
  \begin{center}
    \(
    \textsc{E-Drop}
    \quad
    {\gvRes{a}{\gvConf{C}}}
    \gvRedArr
    {\gvRes{a}{\gvPPar{\gvZap{a}}{\gvConf{C}}}}
    \quad
    \text{if} \; \gvArc{\gvVar{a}}{\gvConf{C}} = 1
    \)
  \end{center}
\end{enumerate}
We can translate programs in linear EGV to affine EGV by replacing all occurrences of $\gvCancel{x}$ with $\gvUnit$. We name this translation $\lta{}$.
Similarly, we can translate programs in affine EGV to linear EGV by inserting $\gvCancel{\!\!}$ operations each time a name goes out of scope. We name this translation $\atl{}$.
\begin{theorem}[Operational Correspondence for $\lta{}$]
  We have:
  \begin{itemize}
  \item
    If $\seq{\ty{\Gamma}}{M}{A}$ and $\gvRedPure{M}{M'}$, then $\gvRedPure{\lta{M}}{\lta{M'}}$.
  \item
    If $\seq{\ty{\Gamma}}{M}{A}$ and $\gvRedPure{\lta{M}}{N}$, there exists an $\tm{M'}$ such that $\gvRedPure{M}{M'}$ and $\tm{N}=\lta{M'}$.
  \item
    If $\cseq{\ty{\Gamma}}{\ty{\Phi}}{\phi}{\gvConf{C}}$ and $\gvRed{\gvConf{C}}{\gvConf{C'}}$, then $\gvRed{\lta{\gvConf{C}}}{\lta{\gvConf{C'}}}$.
  \item
    If $\cseq{\ty{\Gamma}}{\ty{\Phi}}{\phi}{\gvConf{C}}$ and $\gvRed{\lta{\gvConf{C}}}{\gvConf{D}}$, there exists a $\tm{\gvConf{C}}$ such that $\gvRed{\gvConf{C}}{\gvConf{C'}}$ and $\gvConf{D}=\lta{\gvConf{C'}}$.
  \end{itemize}
\end{theorem}
\begin{proof}
  By induction on the reduction. The only interesting case is \textsc{E-Cancel}, which can be replaced by the new rule \textsc{E-Drop}.
\end{proof}

\subsection{Exceptions and the Option Monad}

\subsection{Channels and Shared State}

\end{document}
